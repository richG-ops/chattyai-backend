# 🚀 TheChattyAI Calendar Backend

[![Node.js](https://img.shields.io/badge/Node.js-18+-339933?style=for-the-badge&logo=node.js&logoColor=white)](https://nodejs.org/)
[![Express](https://img.shields.io/badge/Express-4.x-000000?style=for-the-badge&logo=express&logoColor=white)](https://expressjs.com/)
[![Google Calendar API](https://img.shields.io/badge/Google_Calendar-API-4285F4?style=for-the-badge&logo=google-calendar&logoColor=white)](https://developers.google.com/calendar)

**Enterprise-grade calendar booking API with voice AI integration**

## 🚀 Quick Start

```bash
# Install dependencies
npm ci

# Set environment variables
cp .env.example .env

# Start server
npm start
```

## 📡 Core Endpoints

- `GET /health` - Health check
- `GET /get-availability` - Get available time slots
- `POST /book-appointment` - Book an appointment
- `GET /api/clients/:id/metrics` - Dashboard metrics

## 🔐 Environment Variables

```env
GOOGLE_CREDENTIALS='{"web":{"client_id":"...","client_secret":"..."}}'
GOOGLE_TOKEN='{"access_token":"...","refresh_token":"..."}'
JWT_SECRET='your-256-bit-secret-key'
DATABASE_URL='postgresql://user:pass@host:5432/db'
```

## 📄 License

Enterprise License - Contact sales@thechattyai.com 

## 🎯 **Current Status Recap**

Based on your project files, here's exactly where you are and what's needed next:

### **✅ What's Complete:**
- **Backend API**: 95% complete and deployed on Render
- **Frontend**: 70% complete with Next.js/TypeScript
- **Database**: PostgreSQL setup ready
- **Security**: JWT auth, rate limiting, CORS protection
- **Voice AI**: Vapi.ai integration ready

### **🔧 What's Missing:**
- **Environment Variables**: Need to be set properly in Render
- **Frontend Integration**: Connect dashboard to backend API
- **Frontend Deployment**: Deploy to Vercel

---

## 🔑 **Step 1: Environment Variables for Render**

You need to set these **exact environment variables** in your Render dashboard:

### **Go to Render → Your Service → Environment Tab**

**Required Variables:**

```env
# 1. Google Calendar Credentials (CRITICAL)
GOOGLE_CREDENTIALS={"web":{"client_id":"YOUR_ACTUAL_CLIENT_ID","client_secret":"YOUR_ACTUAL_CLIENT_SECRET","project_id":"YOUR_PROJECT_ID","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","redirect_uris":["https://your-app.onrender.com/auth/google/callback"]}}

# 2. Google OAuth Token (CRITICAL)
GOOGLE_TOKEN={"access_token":"YOUR_ACCESS_TOKEN","refresh_token":"YOUR_REFRESH_TOKEN","scope":"https://www.googleapis.com/auth/calendar","token_type":"Bearer","expiry_date":1234567890}

# 3. JWT Secret (CRITICAL)
JWT_SECRET=your-super-secret-jwt-key-minimum-256-bits

# 4. Database (Auto-generated by Render)
DATABASE_URL=postgresql://user:password@host:5432/dbname

# 5. Server Settings
NODE_ENV=production
PORT=4000
```

---

## 📋 **Step 2: Get Your Actual Credentials**

### **Option A: If You Have Google Credentials Already**
1. **Find your `credentials.json`** file on your computer
2. **Copy the entire contents** (the whole JSON object)
3. **Paste it as ONE LINE** in Render's `GOOGLE_CREDENTIALS` field

### **Option B: If You Need New Google Credentials**
1. **Go to**: [Google Cloud Console](https://console.cloud.google.com)
2. **Create/Select Project** → Enable Calendar API
3. **Create Credentials** → OAuth 2.0 Client ID
4. **Set redirect URI**: `https://your-app.onrender.com/auth/google/callback`
5. **Download credentials.json**

### **Get Your Token:**
```powershell
# Run this locally to get your token
node generate-token.js
```

---

## 🚀 **Step 3: Deploy & Test Backend**

### **After Setting Environment Variables:**
1. **Redeploy in Render** → Manual Deploy → Deploy Latest Commit
2. **Test your API**: `https://your-app.onrender.com/health`
3. **Test calendar**: `https://your-app.onrender.com/get-availability`

**Expected Response:**
```json
{
  "status": "success",
  "availability": [
    {
      "date": "2024-01-15",
      "slots": ["09:00", "10:00", "11:00"]
    }
  ]
}
```

---

## 🎯 **Step 4: Frontend Final Integration**

### **Complete These Files:**
1. **`thechattyai-frontend/src/lib/api-client.ts`** - Connect to your backend
2. **`thechattyai-frontend/src/hooks/use-dashboard-data.ts`** - Real API calls
3. **`thechattyai-frontend/src/app/dashboard/page.tsx`** - Live dashboard data

### **Environment Variables for Frontend:**
```env
# In thechattyai-frontend/.env.local
CALENDAR_API_URL=https://your-app.onrender.com
CALENDAR_API_JWT=your-jwt-token-here
NEXTAUTH_SECRET=your-nextauth-secret
```

---

## 🌐 **Step 5: Deploy Frontend to Vercel**

```powershell
# Go to frontend directory
cd thechattyai-frontend

# Install Vercel CLI
npm install -g vercel

# Deploy
vercel

# Set environment variables in Vercel dashboard
```

---

## 📊 **Step 6: Your Complete System URLs**

### **After Deployment:**
- **🔧 Backend API**: `https://your-app.onrender.com`
- **📱 Frontend App**: `https://your-frontend.vercel.app`
- **📊 Dashboard**: `https://your-frontend.vercel.app/dashboard`
- **📝 Client Onboarding**: `https://your-frontend.vercel.app/onboarding`

---

## 🎯 **Immediate Next Actions:**

### **Priority 1 (Today):**
1. **✅ Set Render environment variables** (30 minutes)
2. **✅ Test backend API endpoints** (15 minutes)
3. **✅ Fix any authentication issues** (30 minutes)

### **Priority 2 (This Week):**
1. **🔗 Connect frontend to backend** (2 hours)
2. **🚀 Deploy frontend to Vercel** (1 hour)
3. **🧪 Test complete system** (1 hour)

---

## 🔧 **What You Need Right Now:**

**For Render Environment Setup:**
1. **Your Google `credentials.json` file** 
2. **Your Google OAuth token** (generate with `node generate-token.js`)
3. **A secure JWT secret** (generate with `openssl rand -base64 32`)

**Would you like me to help you:**
- ✅ Generate the JWT secret?
- ✅ Create the token generation script?
- ✅ Set up the exact environment variables?
- ✅ Test the API endpoints?

**Your system is 80% complete - just need these environment variables set correctly and you'll be live!** 🚀 